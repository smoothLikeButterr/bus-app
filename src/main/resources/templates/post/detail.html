<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head><meta charset="UTF-8"><title th:text="${post.title}">ìƒì„¸</title></head>

<script>
    (function () {
      // Thymeleafë¡œ í˜„ì¬ ê²Œì‹œíŒ ì½”ë“œì™€ í˜ì´ì§€ íŒŒë¼ë¯¸í„°ë¥¼ ì£¼ì…í•´ ê¸°ë³¸ ëª©ë¡ URL êµ¬ì„±
      var boardCode = /*[[${boardCode}]]*/ 'FREE';
      var page = /*[[${page}]]*/ 0;
      var size = /*[[${size}]]*/ 20;

      // ê¸°ë³¸ ëª©ë¡ URL (page/sizeê°€ ëª¨ë¸ì— ì—†ìœ¼ë©´ 0/20ìœ¼ë¡œ)
      var defaultListUrl = '/boards/' + boardCode + '?page=' + page + '&size=' + size;

      // ë¦¬ìŠ¤íŠ¸ â†’ ìƒì„¸ë¡œ ë“¤ì–´ì˜¨ ê²½ìš°, referrerê°€ /boards/ ë¥¼ í¬í•¨í•˜ë©´ ê·¸ URLì„ ì €ì¥
      try {
        if (document.referrer && document.referrer.indexOf('/boards/') !== -1) {
          sessionStorage.setItem('lastListUrl', document.referrer);
        }
      } catch (e) { /* storageê°€ ë§‰íŒ í™˜ê²½ ëŒ€ë¹„ ë¬´ì‹œ */ }

      // ë’¤ë¡œê°€ê¸° ì‹œ ëª©ë¡ìœ¼ë¡œ ë³´ë‚´ëŠ” í•¸ë“¤ëŸ¬
      function goBackToList() {
        var url = defaultListUrl;
        try {
          var saved = sessionStorage.getItem('lastListUrl');
          if (saved) url = saved;
        } catch (e) { /* ë¬´ì‹œ */ }
        // replaceë¥¼ ì“°ë©´ 'ì•ìœ¼ë¡œê°€ê¸°' ìŠ¤íƒì´ ì§€ì €ë¶„í•´ì§€ì§€ ì•ŠìŒ
        location.replace(url);
      }

      // popstate ë°œìƒí•˜ë„ë¡ ë”ë¯¸ stateë¥¼ í•œ ë²ˆ ìŒ“ì•„ë‘”ë‹¤.
      // (ì¼ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ ì²« backì— popstateê°€ ì•ˆ ëœ¨ëŠ” ê±¸ ë°©ì§€)
      try {
        history.pushState({ page: 'detail' }, '', location.href);
        window.addEventListener('popstate', function (e) {
          // ë¸Œë¼ìš°ì € ë’¤ë¡œê°€ê¸° ëˆŒë¦¬ë©´ ëª©ë¡ìœ¼ë¡œ
          goBackToList();
        });
      } catch (e) { /* íˆìŠ¤í† ë¦¬ API ë¶ˆê°€ í™˜ê²½ ëŒ€ë¹„ */ }
    })();
</script>

<body>
<h1 th:text="${post.title}">ì œëª©</h1>
<div>
    <span th:text="${post.author.nickname}">ì‘ì„±ì</span> Â·
    <span th:text="${#temporals.format(post.createdAt,'yyyy-MM-dd HH:mm')}">ì‘ì„±ì‹œê°</span>
</div>

<!-- ë¦¬ì•¡ì…˜ ë²„íŠ¼ -->
<form th:action="@{|/posts/${post.id}/reactions?page=${page}&size=${size}|}" method="post" style="display:inline;">
    <input type="hidden" name="type" value="LIKE"/>
    <button type="submit">ğŸ‘</button>
    <span th:text="${post.likeCount}">0</span>
</form>
<form th:action="@{|/posts/${post.id}/reactions?page=${page}&size=${size}|}" method="post" style="display:inline; margin-left:8px;">
    <input type="hidden" name="type" value="DISLIKE"/>
    <button type="submit">ğŸ‘</button>
    <span th:text="${post.dislikeCount}">0</span>
</form>

<hr/>
<div th:utext="${#strings.escapeXml(post.content).replaceAll('\n','<br/>')}">ë‚´ìš©</div>

<hr/>
<h2>ëŒ“ê¸€</h2>

<!-- ëŒ“ê¸€ ëª©ë¡ -->
<div th:if="${#lists.isEmpty(comments)}">ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>
<ul th:if="${!#lists.isEmpty(comments)}" style="list-style:none; padding-left:0;">
    <li th:each="c : ${comments}" th:style="|margin-left:${c.depth * 20}px;|">
    <div>
            <strong th:text="${c.author.nickname}">ë‹‰ë„¤ì„</strong>
            <span> Â· </span>
            <small th:text="${#temporals.format(c.createdAt,'yyyy-MM-dd HH:mm')}">ì‹œê°„</small>
        </div>
        <div th:text="${c.content}">ë‚´ìš©</div>

        <!-- ëŒ€ëŒ“ê¸€ í¼ í† ê¸€ (ì•„ì£¼ ê°„ë‹¨í•œ ë°©ì‹) -->
        <details style="margin:6px 0;">
            <summary>ë‹µê¸€ ë‹¬ê¸°</summary>
            <form th:action="@{|/posts/${post.id}/comments|}"
                  th:object="${commentForm}" method="post">
                <input type="hidden" name="parentId" th:value="${c.id}"/>
                <div><textarea th:field="*{content}" rows="3" cols="70" required></textarea></div>
                <button type="submit">ë“±ë¡</button>
            </form>
        </details>
        <hr/>
    </li>
</ul>

<!-- ìƒˆ ëŒ“ê¸€ ì‘ì„± -->
<h3>ëŒ“ê¸€ ì‘ì„±</h3>
<form th:action="@{|/posts/${post.id}/comments|}"
      th:object="${commentForm}" method="post">
    <input type="hidden" name="parentId" value=""/>
    <div><textarea th:field="*{content}" rows="4" cols="80" required></textarea></div>
    <button type="submit">ë“±ë¡</button>
</form>

<p><a th:href="@{|/boards/${boardCode}?page=${page}&size=${size}|}">ëª©ë¡ìœ¼ë¡œ</a></p>
</body>
</html>
